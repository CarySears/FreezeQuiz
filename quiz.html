<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Functional Freeze Quiz | The Thaw Method</title>
    <meta
      name="description"
      content="Take the Functional Freeze Quiz and receive your Freeze Signature results with a calm + clarity Thaw Plan."
    />
    <style>
      :root {
        --ink: #1b1f3b;
        --ink-soft: #313861;
        --mist: #f4f1ed;
        --sand: #f2dcc7;
        --coral: #f06e5f;
        --teal: #69c6c0;
        --lavender: #c7c2f3;
        --sun: #ffd48f;
        --white: #ffffff;
        --shadow: 0 18px 45px rgba(27, 31, 59, 0.16);
        --radius-lg: 28px;
        --radius-md: 18px;
        --radius-sm: 12px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        color: var(--ink);
        background: linear-gradient(180deg, #fff 0%, #f8f4f0 100%);
        line-height: 1.6;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .container {
        width: min(960px, 92vw);
        margin: 0 auto;
      }

      .nav {
        padding: 1.4rem 0;
      }

      .nav-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .brand {
        font-weight: 700;
        letter-spacing: 0.4px;
      }

      .brand span {
        display: block;
        font-weight: 500;
        font-size: 0.85rem;
        color: var(--ink-soft);
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(105, 198, 192, 0.18);
        color: var(--ink);
        padding: 0.35rem 0.9rem;
        border-radius: 999px;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.85rem 1.6rem;
        border-radius: 999px;
        font-weight: 700;
        background: var(--coral);
        color: var(--white);
        box-shadow: var(--shadow);
        border: none;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 22px 50px rgba(27, 31, 59, 0.2);
      }

      .btn.secondary {
        background: transparent;
        color: var(--ink);
        border: 1px solid rgba(27, 31, 59, 0.2);
        box-shadow: none;
      }

      .hero {
        padding: 2.6rem 0 1.5rem;
      }

      .hero h1 {
        font-size: clamp(2.2rem, 3vw, 3rem);
        margin: 1rem 0 0.8rem;
      }

      .lead {
        max-width: 680px;
        color: var(--ink-soft);
      }

      .list {
        margin: 0.8rem 0 0;
        padding-left: 1.1rem;
        color: var(--ink-soft);
      }

      .list li {
        margin-bottom: 0.5rem;
      }

      .section {
        padding: 2rem 0 4rem;
      }

      .quiz-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 2.4rem;
        box-shadow: var(--shadow);
      }

      .quiz-progress {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        margin-bottom: 1.6rem;
      }

      .quiz-step {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--ink-soft);
      }

      .quiz-bar {
        height: 8px;
        background: rgba(27, 31, 59, 0.08);
        border-radius: 999px;
        overflow: hidden;
      }

      .quiz-bar-fill {
        height: 100%;
        width: 20%;
        background: linear-gradient(90deg, var(--teal), var(--coral));
        transition: width 0.3s ease;
      }

      .quiz-question {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }

      .quiz-options {
        display: grid;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .quiz-option {
        border: 1px solid rgba(27, 31, 59, 0.12);
        border-radius: var(--radius-md);
        padding: 0.9rem 1.1rem;
        background: var(--white);
        text-align: left;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      }

      .quiz-option:hover {
        border-color: var(--teal);
        box-shadow: 0 8px 20px rgba(27, 31, 59, 0.1);
        transform: translateY(-1px);
      }

      .quiz-option.selected {
        border-color: var(--coral);
        background: rgba(240, 110, 95, 0.08);
      }

      .quiz-skip {
        background: none;
        border: none;
        color: var(--ink-soft);
        text-decoration: underline;
        cursor: pointer;
        font-size: 0.95rem;
      }

      .quiz-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 1.4rem;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .quiz-form {
        display: grid;
        gap: 1.2rem;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }

      .form-field label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.4rem;
      }

      .form-field input {
        width: 100%;
        padding: 0.7rem 0.85rem;
        border-radius: var(--radius-sm);
        border: 1px solid rgba(27, 31, 59, 0.2);
        font-size: 1rem;
        font-family: inherit;
      }

      .form-helper {
        color: var(--ink-soft);
        font-size: 0.9rem;
        margin: 0;
      }

      .quiz-results {
        position: relative;
        display: grid;
        gap: 1rem;
      }

      .result-primary {
        position: relative;
        background: linear-gradient(135deg, rgba(105, 198, 192, 0.2), rgba(240, 110, 95, 0.08));
        border-radius: var(--radius-md);
        padding: 1.4rem;
        border: 1px solid rgba(27, 31, 59, 0.08);
      }

      .result-primary::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background:
          radial-gradient(circle at 15% 10%, rgba(255, 212, 143, 0.45), transparent 60%),
          radial-gradient(circle at 80% 20%, rgba(105, 198, 192, 0.35), transparent 55%);
        opacity: 0;
        pointer-events: none;
      }

      .result-badge {
        display: inline-block;
        background: rgba(27, 31, 59, 0.12);
        color: var(--ink);
        padding: 0.25rem 0.7rem;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 0.6rem;
      }

      .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }

      .result-card {
        border: 1px solid rgba(27, 31, 59, 0.12);
        border-radius: var(--radius-md);
        padding: 1.2rem;
        background: var(--white);
      }

      .result-card.primary {
        border-color: rgba(240, 110, 95, 0.35);
        box-shadow: 0 10px 24px rgba(240, 110, 95, 0.15);
      }

      .result-percent {
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 0.4rem;
      }

      .result-cta {
        margin-top: 1.6rem;
        border-top: 1px solid rgba(27, 31, 59, 0.1);
        padding-top: 1.6rem;
        display: grid;
        gap: 1rem;
      }

      .result-columns {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }

      .price-note {
        font-weight: 600;
        color: var(--ink);
      }

      .sparkle {
        position: absolute;
        top: -10px;
        right: 18px;
        display: flex;
        gap: 6px;
        pointer-events: none;
      }

      .sparkle span {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--sun);
        box-shadow: 0 0 14px rgba(255, 212, 143, 0.85);
        opacity: 0;
        transform: translateY(8px) scale(0.6);
        --x1: 0px;
        --y1: -12px;
        --x2: 0px;
        --y2: -26px;
      }

      .quiz-results.celebrate .sparkle span {
        animation: sparkle 1.2s ease-out forwards;
      }

      .quiz-results.celebrate .result-primary {
        animation: resultPop 0.7s ease-out;
      }

      .quiz-results.celebrate .result-primary::after {
        animation: glowPulse 1.2s ease-out forwards;
      }

      .quiz-results.celebrate .sparkle span:nth-child(2) {
        animation-delay: 0.1s;
        background: var(--teal);
        box-shadow: 0 0 14px rgba(105, 198, 192, 0.7);
        --x1: 10px;
        --y1: -18px;
        --x2: 18px;
        --y2: -32px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(3) {
        animation-delay: 0.2s;
        --x1: -12px;
        --y1: -20px;
        --x2: -20px;
        --y2: -34px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(4) {
        animation-delay: 0.3s;
        background: var(--lavender);
        box-shadow: 0 0 14px rgba(199, 194, 243, 0.7);
        --x1: 6px;
        --y1: -10px;
        --x2: 14px;
        --y2: -26px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(5) {
        animation-delay: 0.4s;
        --x1: -6px;
        --y1: -8px;
        --x2: -12px;
        --y2: -22px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(6) {
        animation-delay: 0.5s;
        background: var(--teal);
        box-shadow: 0 0 14px rgba(105, 198, 192, 0.7);
        --x1: 16px;
        --y1: -12px;
        --x2: 26px;
        --y2: -30px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(7) {
        animation-delay: 0.6s;
        --x1: -18px;
        --y1: -14px;
        --x2: -26px;
        --y2: -30px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(8) {
        animation-delay: 0.7s;
        background: var(--lavender);
        box-shadow: 0 0 14px rgba(199, 194, 243, 0.7);
        --x1: 4px;
        --y1: -22px;
        --x2: 12px;
        --y2: -38px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(9) {
        animation-delay: 0.8s;
        --x1: -4px;
        --y1: -18px;
        --x2: -10px;
        --y2: -34px;
      }

      .quiz-results.celebrate .sparkle span:nth-child(10) {
        animation-delay: 0.9s;
        background: var(--teal);
        box-shadow: 0 0 14px rgba(105, 198, 192, 0.7);
        --x1: 12px;
        --y1: -26px;
        --x2: 20px;
        --y2: -42px;
      }

      @keyframes sparkle {
        0% {
          opacity: 0;
          transform: translate(0px, 10px) scale(0.6);
        }
        50% {
          opacity: 1;
          transform: translate(var(--x1), var(--y1)) scale(1.25);
        }
        100% {
          opacity: 0;
          transform: translate(var(--x2), var(--y2)) scale(0.4);
        }
      }

      @keyframes glowPulse {
        0% {
          opacity: 0;
          transform: scale(0.98);
        }
        40% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: scale(1.03);
        }
      }

      @keyframes resultPop {
        0% {
          transform: scale(0.96);
        }
        60% {
          transform: scale(1.03);
        }
        100% {
          transform: scale(1);
        }
      }

      .hidden {
        display: none;
      }

      @media (max-width: 720px) {
        .nav-inner {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <header class="nav">
      <div class="container nav-inner">
        <div class="brand">
          Healing Cosmos by Jai McPheron Presents
          <span>The Thaw Method (TM)</span>
        </div>
        <a class="btn secondary" href="index.html">Back to homepage</a>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="container">
          <span class="pill">Functional Freeze Quiz</span>
          <h1>Discover your Freeze Signature</h1>
          <p class="lead">
            Answer five quick questions and receive your Freeze Signature Type, Freeze % score, and a calm + clarity
            Thaw Plan. Trauma-informed. No graphic questions.
          </p>
        </div>
      </section>

      <section class="section">
        <div class="container">
          <div class="quiz-card" id="quiz-app">
            <div class="quiz-progress" id="quiz-progress">
              <div class="quiz-step" id="quiz-step">Question 1 of 5</div>
              <div class="quiz-bar">
                <div class="quiz-bar-fill" id="quiz-bar-fill"></div>
              </div>
            </div>
            <div class="quiz-body" id="quiz-body">
              <h3 class="quiz-question" id="quiz-question"></h3>
              <div class="quiz-options" id="quiz-options"></div>
              <button class="quiz-skip" id="quiz-skip" type="button">None of these resonate</button>
              <div class="quiz-nav">
                <button class="btn secondary" id="quiz-back" type="button">Back</button>
                <p class="form-helper">Choose the option that fits best right now.</p>
              </div>
            </div>
            <form class="quiz-form hidden" id="quiz-form">
              <h3>Where should we send your results?</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="quiz-name">Full name *</label>
                  <input id="quiz-name" name="name" type="text" required autocomplete="name" />
                </div>
                <div class="form-field">
                  <label for="quiz-email">Email *</label>
                  <input id="quiz-email" name="email" type="email" required autocomplete="email" />
                </div>
                <div class="form-field">
                  <label for="quiz-phone">Phone (optional)</label>
                  <input id="quiz-phone" name="phone" type="tel" autocomplete="tel" />
                </div>
              </div>
              <p class="form-helper">
                We only use your info to deliver your results and support your next steps.
              </p>
              <div class="quiz-nav">
                <button class="btn secondary" id="quiz-form-back" type="button">Back</button>
                <button class="btn" type="submit">See my results</button>
              </div>
            </form>
            <div class="quiz-results hidden" id="quiz-results">
              <h3>Your Freeze Signature Results</h3>
              <p class="lead">Thank you for taking the time to complete this quiz.</p>
              <div class="result-primary" id="result-primary">
                <div class="result-badge">Primary Freeze Signature</div>
                <h3 id="primary-name"></h3>
                <p id="primary-desc"></p>
                <div class="sparkle" aria-hidden="true">
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
              <div class="result-grid" id="result-grid"></div>
              <div class="result-cta" id="result-cta">
                <h3 id="offer-title"></h3>
                <p id="offer-copy"></p>
                <div class="result-columns">
                  <div>
                    <h4>What you need right now (start here today)</h4>
                    <ul class="list" id="offer-advice"></ul>
                  </div>
                  <div>
                    <h4>What the course unlocks</h4>
                    <ul class="list" id="offer-benefits"></ul>
                  </div>
                </div>
                <p class="lead" id="offer-close"></p>
                <div class="quiz-nav">
                  <a class="btn" id="offer-cta" href="checkout-vigilant-mind.html">Unlock my Thaw Plan</a>
                  <p class="form-helper">Your next step is ready whenever you are.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const quizCategories = [
        {
          name: "Vigilant Mind - Frozen Body",
          description:
            "Your system stays alert to keep you safe. Early thaw often looks like grounding, slower pace, and feeling support in your body.",
        },
        {
          name: "Collapsed Core",
          description:
            "Your energy dips to conserve. Early thaw looks like gentle structure, nourishment, and confidence returning.",
        },
        {
          name: "Guarded Heart",
          description:
            "Closeness feels risky, so your heart stays protected. Thaw happens with safety, pacing, and permission to feel.",
        },
        {
          name: "Grief-Bound Protector",
          description:
            "Grief is held in the chest and shoulders. Thaw comes through breath, softening, and emotional release.",
        },
        {
          name: "Quietly Agitated Warrior",
          description:
            "Frustration turns inward and feels restless. Thaw comes through safe movement, expression, and flow.",
        },
      ];

      const courseOffers = [
        {
          title: "Your next step: The Vigilant Mind - Frozen Body Course",
          copy:
            "These steps give a moment of relief. The course is the full protocol to shut down the scan loop, restore deep rest, and make calm your default without dulling your edge.",
          advice: [
            "Drop awareness into belly, hips, and feet to soften the scan now.",
            "Name one predictable thing three times to anchor safety today.",
            "Use slow, warm exhales to tell your body it can land.",
            "Hand on lower belly and heart to settle the signal.",
            "Use micro-resets when your mind races.",
            "Let your body lead before your mind tries to fix it.",
          ],
          benefits: [
            "End the vigilance loop without losing awareness.",
            "Sleep deeper and decide with less effort.",
            "Feel safe in your body, not just in your head.",
            "Build predictable calm you can rely on.",
          ],
          checkout: "checkout-vigilant-mind.html",
          ctaLabel: "End the Vigilance Loop Now",
          close:
            "If you stay in scan mode, your system keeps paying. Lock in the course now and start retraining your nervous system today.",
        },
        {
          title: "Your next step: The Collapsed Core Course",
          copy:
            "These small shifts can lift you today. The course gives you a gentle structure that keeps energy, confidence, and follow-through from slipping away.",
          advice: [
            "Stand or sit 2% taller to signal safety and strength now.",
            "Let the belly soften so your center can wake up.",
            "Visualize a glow one inch beyond your skin to reclaim space.",
            "Imagine ribs widening like small wings to re-open breath.",
            "Choose one tiny action you can complete today.",
            "Build momentum with consistency, not force.",
          ],
          benefits: [
            "Restore steady energy and motivation.",
            "Rebuild confidence in your core and choices.",
            "Stop collapsing under responsibility.",
            "Create momentum that lasts.",
          ],
          checkout: "checkout-collapsed-core.html",
          ctaLabel: "Rebuild My Energy and Confidence",
          close:
            "Without a structure, collapse keeps repeating. Start the course and rebuild your center one gentle day at a time.",
        },
        {
          title: "Your next step: The Guarded Heart Course",
          copy:
            "These steps soften the edges. The course gives you a safe path to open without overwhelm and finally receive without bracing.",
          advice: [
            "Hand on heart, hand on belly, breathe gently to invite safety now.",
            "Name the faintest emotion so the heart can thaw 1% at a time.",
            "Warmth before intensity, wrap a blanket around your shoulders.",
            "Picture a soft light warming the edges of numbness.",
            "Let one moment of care in without explaining it away.",
            "Choose connection in small, safe doses.",
          ],
          benefits: [
            "Open your heart without losing boundaries.",
            "Receive care without bracing or shrinking.",
            "Release chest armor and soften emotional vigilance.",
            "Build real relational safety from the inside out.",
          ],
          checkout: "checkout-guarded-heart.html",
          ctaLabel: "Open My Heart Without Overwhelm",
          close:
            "If you stay guarded, connection stays out of reach. The course is your safe path back to intimacy without overwhelm.",
        },
        {
          title: "Your next step: The Grief-Bound Protector Course",
          copy:
            "These steps open a crack in the shield today. The course turns that crack into consistent breath, lighter shoulders, and emotions that move without flooding.",
          advice: [
            "Drop the shoulders on the exhale to feel the first softening.",
            "Name one small strand of sadness to let it move instead of stick.",
            "Breathe into the back of the heart to reclaim space for breath.",
            "Visualize a soft white mist clearing heaviness.",
            "Soften the chest instead of forcing a deep breath.",
            "Let grief move in small, safe waves.",
          ],
          benefits: [
            "Release grief safely without flooding.",
            "Breathe deeper and feel lighter in your chest.",
            "Soften shoulder tension and upper-back armor.",
            "Restore openness without losing stability.",
          ],
          checkout: "checkout-grief-bound-protector.html",
          ctaLabel: "Release My Grief Shield",
          close:
            "If you keep holding it together, the heaviness stays. The course gives you a safe path to release and breathe again.",
        },
        {
          title: "Your next step: The Quietly Agitated Warrior Course",
          copy:
            "These steps vent pressure fast. The course turns that pressure into clear power, clean movement, and boundaries that hold.",
          advice: [
            "Soften the right ribs and exhale into the flanks.",
            "Acknowledge anger safely so it stops living in your body.",
            "Unclench jaw, shoulders, and eyes on the exhale.",
            "Practice one micro-boundary so your power feels safe.",
            "Give your pressure a safe outlet today.",
            "Move the energy before it turns inward.",
          ],
          benefits: [
            "Release pressure without burnout or blowups.",
            "Restore clean boundaries and direction.",
            "Unclench the ribs and diaphragm for real relief.",
            "Turn anger into clarity and grounded power.",
          ],
          checkout: "checkout-quietly-agitated-warrior.html",
          ctaLabel: "Turn Pressure Into Clear Power",
          close:
            "If pressure keeps building, it spills. Start the course and channel that fire into power you can trust.",
        },
      ];

      const quizQuestions = [
        {
          prompt: "Which statement feels most true?",
          options: [
            "I need to anticipate danger to stay safe.",
            "I never seem to have enough energy.",
            "I protect my heart because closeness feels risky.",
            "I carry grief or sadness I cannot fully express.",
            "I bottle up frustration until it explodes or implodes.",
          ],
          skipLabel: "None of these resonate",
        },
        {
          prompt: "What happens in your relationships?",
          options: [
            "I get stuck in my head and worry about what people think.",
            "I shut down and lack the energy to stay engaged.",
            "I keep emotional walls up to avoid disappointment.",
            "I feel unseen or weighed down.",
            "I feel resentment or irritation but do not express it.",
          ],
          skipLabel: "None of these resonate",
        },
        {
          prompt: "When you try to relax, what stops you?",
          options: [
            "My mind will not slow down.",
            "Relaxation feels like collapsing even more.",
            "I cannot let my guard down.",
            "Sadness surfaces immediately.",
            "I feel restless or agitated inside.",
          ],
          skipLabel: "I can relax when I decide to / None of the above",
        },
        {
          prompt: "What best describes your childhood pattern?",
          options: [
            "Hyper-alert, careful, managing danger.",
            "Not seen, not supported, had to shrink.",
            "Had to be emotionally mature or controlled.",
            "Experienced loss or emotional distance.",
            "Learned not to express anger.",
          ],
          skipLabel: "I do not recall any of these prominently",
        },
        {
          prompt: "What kind of help feels most supportive right now?",
          options: [
            "Tools to calm my mind and feel safe in my body.",
            "Gentle energy-building and confidence restoration.",
            "Practices for opening my heart safely.",
            "Support for releasing grief and softening tension.",
            "Techniques for releasing internal pressure.",
          ],
          skipLabel: "I am not really feeling any of these right now",
        },
      ];

      const quizElements = {
        app: document.getElementById("quiz-app"),
        progress: document.getElementById("quiz-progress"),
        step: document.getElementById("quiz-step"),
        barFill: document.getElementById("quiz-bar-fill"),
        body: document.getElementById("quiz-body"),
        question: document.getElementById("quiz-question"),
        options: document.getElementById("quiz-options"),
        skip: document.getElementById("quiz-skip"),
        back: document.getElementById("quiz-back"),
        form: document.getElementById("quiz-form"),
        formBack: document.getElementById("quiz-form-back"),
        results: document.getElementById("quiz-results"),
        primaryName: document.getElementById("primary-name"),
        primaryDesc: document.getElementById("primary-desc"),
        resultGrid: document.getElementById("result-grid"),
        offerTitle: document.getElementById("offer-title"),
        offerCopy: document.getElementById("offer-copy"),
        offerAdvice: document.getElementById("offer-advice"),
        offerBenefits: document.getElementById("offer-benefits"),
        offerClose: document.getElementById("offer-close"),
        offerCta: document.getElementById("offer-cta"),
      };

      if (quizElements.app) {
        const RESULTS_KEY = "thawQuizResults";
        let currentIndex = 0;
        const responses = Array(quizQuestions.length).fill(null);

        const loadSavedResults = () => {
          try {
            const raw = localStorage.getItem(RESULTS_KEY);
            if (!raw) {
              return null;
            }
            const data = JSON.parse(raw);
            if (!Array.isArray(data.percents) || typeof data.primaryIndex !== "number") {
              return null;
            }
            return data;
          } catch (error) {
            return null;
          }
        };

        const saveResults = (data) => {
          try {
            localStorage.setItem(RESULTS_KEY, JSON.stringify(data));
          } catch (error) {
            return;
          }
        };

        const updateProgress = (labelOverride) => {
          if (quizElements.step) {
            quizElements.step.textContent =
              labelOverride || `Question ${currentIndex + 1} of ${quizQuestions.length}`;
          }
          if (quizElements.barFill) {
            const percent = Math.round(((currentIndex + 1) / quizQuestions.length) * 100);
            quizElements.barFill.style.width = `${percent}%`;
          }
        };

        const renderQuestion = () => {
          const currentQuestion = quizQuestions[currentIndex];
          quizElements.question.textContent = currentQuestion.prompt;
          quizElements.options.innerHTML = "";

          currentQuestion.options.forEach((option, index) => {
            const button = document.createElement("button");
            button.type = "button";
            button.className = "quiz-option";
            button.textContent = option;
            if (responses[currentIndex] === index) {
              button.classList.add("selected");
            }
            button.addEventListener("click", () => {
              responses[currentIndex] = index;
              button.classList.add("selected");
              setTimeout(() => {
                goNext();
              }, 120);
            });
            quizElements.options.appendChild(button);
          });

          quizElements.skip.textContent = currentQuestion.skipLabel || "None of these resonate";
          quizElements.back.style.visibility = currentIndex === 0 ? "hidden" : "visible";
          updateProgress();
        };

        const goNext = () => {
          if (currentIndex < quizQuestions.length - 1) {
            currentIndex += 1;
            renderQuestion();
          } else {
            showForm();
          }
        };

        const showForm = () => {
          quizElements.body.classList.add("hidden");
          quizElements.form.classList.remove("hidden");
          quizElements.results.classList.add("hidden");
          quizElements.progress.classList.remove("hidden");
          updateProgress("Final step");
          quizElements.barFill.style.width = "100%";
        };

        const showResults = () => {
          quizElements.form.classList.add("hidden");
          quizElements.results.classList.remove("hidden");
          quizElements.progress.classList.add("hidden");
          quizElements.results.classList.remove("celebrate");
          setTimeout(() => {
            quizElements.results.classList.add("celebrate");
          }, 80);
        };

        const calculateResults = () => {
          const totals = quizCategories.map(() => 0);
          let answered = 0;
          responses.forEach((value) => {
            if (value !== null) {
              totals[value] += 1;
              answered += 1;
            }
          });
          const percents = totals.map((count) =>
            answered === 0 ? 0 : Math.round((count / answered) * 100)
          );
          let primaryIndex = 0;
          percents.forEach((percent, index) => {
            if (percent > percents[primaryIndex]) {
              primaryIndex = index;
            }
          });
          return { percents, primaryIndex, answered };
        };

        const renderResults = (saved) => {
          const data = saved || calculateResults();
          const { percents, primaryIndex, answered } = data;
          const primary = quizCategories[primaryIndex];
          quizElements.primaryName.textContent = `${primary.name} (${percents[primaryIndex]}%)`;
          quizElements.primaryDesc.textContent =
            answered === 0
              ? "No dominant pattern selected yet. You can retake the quiz and choose the closest fit."
              : primary.description;

          quizElements.resultGrid.innerHTML = "";
          quizCategories.forEach((category, index) => {
            const card = document.createElement("div");
            card.className = "result-card";
            if (index === primaryIndex && answered > 0) {
              card.classList.add("primary");
            }

            const percent = document.createElement("div");
            percent.className = "result-percent";
            percent.textContent = `${percents[index]}%`;

            const title = document.createElement("h4");
            title.textContent = category.name;

            const desc = document.createElement("p");
            desc.textContent = category.description;

            card.appendChild(percent);
            card.appendChild(title);
            card.appendChild(desc);
            quizElements.resultGrid.appendChild(card);
          });

          if (answered === 0) {
            quizElements.offerTitle.textContent = "Not sure yet?";
            quizElements.offerCopy.textContent =
              "Retake the quiz and choose the closest match so we can guide you to the right course.";
            quizElements.offerAdvice.innerHTML = "";
            quizElements.offerBenefits.innerHTML = "";
            quizElements.offerClose.textContent = "";
            quizElements.offerCta.textContent = "Retake the quiz";
            quizElements.offerCta.href = "quiz.html";
            return;
          }

          const offer = courseOffers[primaryIndex];
          quizElements.offerTitle.textContent = offer.title;
          quizElements.offerCopy.textContent = offer.copy;
          quizElements.offerAdvice.innerHTML = "";
          offer.advice.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            quizElements.offerAdvice.appendChild(li);
          });
          quizElements.offerBenefits.innerHTML = "";
          offer.benefits.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            quizElements.offerBenefits.appendChild(li);
          });
          quizElements.offerClose.textContent = offer.close;
          quizElements.offerCta.textContent = offer.ctaLabel;
          quizElements.offerCta.href = offer.checkout;

          if (!saved) {
            saveResults({
              percents,
              primaryIndex,
              answered,
              savedAt: Date.now(),
            });
          }
        };

        quizElements.skip.addEventListener("click", () => {
          responses[currentIndex] = null;
          goNext();
        });

        quizElements.back.addEventListener("click", () => {
          if (currentIndex > 0) {
            currentIndex -= 1;
            renderQuestion();
          }
        });

        quizElements.formBack.addEventListener("click", () => {
          quizElements.form.classList.add("hidden");
          quizElements.body.classList.remove("hidden");
          quizElements.progress.classList.remove("hidden");
          currentIndex = quizQuestions.length - 1;
          renderQuestion();
        });

        quizElements.form.addEventListener("submit", (event) => {
          event.preventDefault();
          if (!quizElements.form.reportValidity()) {
            return;
          }
          renderResults();
          showResults();
        });

        const params = new URLSearchParams(window.location.search);
        const savedResults = loadSavedResults();
        if (params.has("results") && savedResults) {
          renderResults(savedResults);
          showResults();
        } else {
          renderQuestion();
        }
      }
    </script>
  </body>
</html>
